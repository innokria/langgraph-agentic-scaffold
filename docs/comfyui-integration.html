<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ComfyUI Integration with Agentic Workflows</title>
    <meta name="description" content="A visualization showing how a ComfyUI custom node can invoke a remote, multi-agent framework via an API to perform complex tasks.">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-bg: #0A0A0A;
            --color-text: #E0E0E0;
            --color-text-dim: #999999;
            --color-border: #2A2A2A;
            --color-card: #141414;
            --color-comfy-node: #2ECC71;
            --color-api-call: #3498DB;
            --color-api-response: #9B59B6;
        }

        body {
            background-color: var(--color-bg);
            color: var(--color-text);
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .connector-path {
            stroke-width: 1.5px;
            fill: none;
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
            animation: draw-line 1.5s ease-out forwards;
            animation-delay: var(--delay, 0s);
        }
        .connector-path.dashed { stroke-dasharray: 6, 6; }
        .connector-label {
            font-size: 11px;
            font-family: 'Inter', sans-serif;
            fill: var(--color-text-dim);
            text-anchor: middle;
            opacity: 0;
            animation: fade-in-text 1s ease-out forwards;
            animation-delay: var(--delay, 0s);
        }

        @keyframes draw-line { to { stroke-dashoffset: 0; } }
        @keyframes fade-in-text { to { opacity: 1; } }

        .fade-in-up {
            opacity: 0;
            transform: translateY(20px);
            animation: fade-in-up-anim 0.8s cubic-bezier(0.215, 0.610, 0.355, 1.000) forwards;
            animation-delay: var(--delay, 0s);
        }

        @keyframes fade-in-up-anim { to { opacity: 1; transform: translateY(0); } }
        
        .node-card {
            background-color: var(--color-card);
            border: 1px solid var(--color-border);
            transition: all 0.3s ease;
        }
        
        .subgraph-title {
            color: var(--color-text-dim);
            font-size: 0.8rem;
            font-weight: 500;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            text-align: center;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--color-border);
        }
    </style>
</head>
<body class="overflow-x-hidden">

    <div class="relative min-h-screen w-full">
        <main class="relative z-10 p-4 sm:p-8 md:p-12">
            <header class="fade-in-up">
                <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-center text-white">ComfyUI Agentic Workflow Integration</h1>
                <p class="mt-4 max-w-3xl mx-auto text-center text-lg text-gray-400">Demonstrating how a local ComfyUI canvas can trigger and retrieve results from a powerful, remote multi-agent system via a simple API.</p>
            </header>

            <div id="visualization-container" class="relative mt-16 md:mt-24 max-w-7xl mx-auto">
                <svg id="connector-svg" class="absolute top-0 left-0 w-full h-full z-0" aria-hidden="true"></svg>

                <div class="relative z-10 grid grid-cols-1 md:grid-cols-2 gap-x-16 gap-y-12">
                    
                    <!-- ComfyUI Canvas -->
                    <div class="fade-in-up" style="--delay: 0.2s;">
                        <div class="subgraph-title">ComfyUI Canvas (Local)</div>
                        <div class="space-y-12">
                            <div id="node-Input" class="node-card p-4 rounded-lg text-center">
                                <h3 class="font-semibold text-white">String Primitive</h3>
                            </div>
                            <div id="node-CustomNode" class="node-card p-4 rounded-lg text-center border-2" style="border-color: var(--color-comfy-node);">
                                <h3 class="font-semibold text-white">Invoke Agentic Workflow</h3>
                                <p class="text-sm text-gray-400 mt-1">(Custom Node)</p>
                            </div>
                            <div id="node-Preview" class="node-card p-4 rounded-lg text-center">
                                <h3 class="font-semibold text-white">Preview Image</h3>
                            </div>
                        </div>
                    </div>

                    <!-- Agentic Framework -->
                    <div class="fade-in-up" style="--delay: 0.4s;">
                        <div class="subgraph-title">Agentic Framework (Remote)</div>
                        <div class="space-y-12">
                            <div id="node-API" class="node-card p-4 rounded-lg text-center">
                                <h3 class="font-semibold text-white">API Endpoint</h3>
                                <p class="text-sm text-gray-400 mt-1">/api/v1/workflows</p>
                            </div>
                            <div id="node-CoS" class="node-card p-4 rounded-lg text-center">
                                <h3 class="font-semibold text-white">Chief of Staff</h3>
                            </div>
                            <div id="node-Engine" class="node-card p-4 rounded-lg text-center">
                                <h3 class="font-semibold text-white">QMS Engine</h3>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const svg = document.getElementById('connector-svg');
    const container = document.getElementById('visualization-container');

    function createConnector(id, startNodeId, endNodeId, color, delay, options = {}) {
        const startNode = document.getElementById(startNodeId);
        const endNode = document.getElementById(endNodeId);
        if (!startNode || !endNode) return;

        const containerRect = container.getBoundingClientRect();
        const startRect = startNode.getBoundingClientRect();
        const endRect = endNode.getBoundingClientRect();

        let startX = startRect.left + startRect.width / 2 - containerRect.left;
        let startY = startRect.bottom - containerRect.top;
        let endX = endRect.left + endRect.width / 2 - containerRect.left;
        let endY = endRect.top - containerRect.top;

        if (options.startSide === 'right') startX = startRect.right - containerRect.left;
        if (options.endSide === 'left') endX = endRect.left - containerRect.left;
        if (options.startSide === 'left') startX = startRect.left - containerRect.left;
        if (options.endSide === 'right') endX = endRect.right - containerRect.left;

        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        let d;
        if (options.curve) {
            const c1x = startX + options.curve.x;
            const c1y = startY + options.curve.y;
            const c2x = endX - options.curve.x;
            const c2y = endY - options.curve.y;
            d = `M ${startX} ${startY} C ${c1x} ${c1y}, ${c2x} ${c2y}, ${endX} ${endY}`;
        } else {
            const midY = startY + (endY - startY) * 0.5;
            d = `M ${startX} ${startY} C ${startX} ${midY}, ${endX} ${midY}, ${endX} ${endY}`;
        }
        
        path.setAttribute('d', d);
        path.setAttribute('class', 'connector-path');
        path.setAttribute('stroke', color);
        path.style.setProperty('--delay', `${delay}s`);
        if (options.dashed) path.classList.add('dashed');
        svg.appendChild(path);

        if (options.label) {
            const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            text.textContent = options.label;
            text.setAttribute('class', 'connector-label');
            text.style.setProperty('--delay', `${delay + 0.5}s`);
            text.setAttribute('fill', color);
            
            const pathLength = path.getTotalLength();
            const point = path.getPointAtLength(pathLength / 2);
            text.setAttribute('x', point.x);
            text.setAttribute('y', point.y - 10);
            svg.appendChild(text);
        }
    }

    function drawConnectors() {
        svg.innerHTML = '';
        // Local ComfyUI connections
        createConnector('c1', 'node-Input', 'node-CustomNode', 'var(--color-text-dim)', 0.5);
        createConnector('c2', 'node-CustomNode', 'node-Preview', 'var(--color-text-dim)', 0.6);

        // Remote Framework connections
        createConnector('c3', 'node-API', 'node-CoS', 'var(--color-text-dim)', 0.7);
        createConnector('c4', 'node-CoS', 'node-Engine', 'var(--color-text-dim)', 0.8);

        // API Calls
        const curve = { x: 60, y: 0 };
        createConnector('api1', 'node-CustomNode', 'node-API', 'var(--color-api-call)', 1.0, { startSide: 'right', endSide: 'left', curve, label: '1. POST Request' });
        createConnector('api2', 'node-API', 'node-CustomNode', 'var(--color-api-response)', 1.2, { startSide: 'left', endSide: 'right', curve, dashed: true, label: '2. Returns {workflow_id}' });
        createConnector('api3', 'node-CustomNode', 'node-API', 'var(--color-api-call)', 1.4, { startSide: 'right', endSide: 'left', curve: {x: 60, y: 20}, label: '3. Polls GET /workflows/{id}' });
        createConnector('api4', 'node-API', 'node-CustomNode', 'var(--color-api-response)', 1.6, { startSide: 'left', endSide: 'right', curve: {x: 60, y: -20}, dashed: true, label: '4. Returns {status: "COMPLETED"}' });
    }

    const observer = new IntersectionObserver((e) => e.forEach(entry => entry.isIntersecting && setTimeout(drawConnectors, 100)), { threshold: 0.1 });
    observer.observe(container);
    window.addEventListener('resize', () => setTimeout(drawConnectors, 250));
});
</script>
</body>
</html>
